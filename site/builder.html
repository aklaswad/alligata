<script>window.Alligata = {};</script>
<script src="parser.js"></script>
<script src="compiler.js"></script>
<script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
<script src="coffee-script.js"></script>
<script>
$( function () {
  var run = function () {
    var exp = $('#expression').val()
      , code;
    exp = exp.replace(/^\s+/,'');
    exp = exp.replace(/\s+$/,'');
    try {
      code = Alligata.compile(exp);
    }
    catch (e) {
      $('#code').val('');
      $('#error').text(e);
      return;
    }
    $('#code').val(code);
    $('#error').text('');
  };

  var guard = 0;
  $('#expression').on( 'keyup', function () {
    if ( guard++ ) return;
    setTimeout( function () {
      if ( guard > 1 ) {
        run();
        guard = 0;
      }
    },1000);
    run();
  });

  run();
});
</script>
<link rel="stylesheet" type="text/css" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" />

<style>
html,body {
  width: 100%;
  height: 100%;
}

#expression {
  height: 300px;
  font-size: 14px;
  width: 300px;
  border: 1px solid #789;
  margin: 10px;
  padding: 0;
  box-sizing: border-box;
  display: inline-block;
}

#code {
  width: 300px;
  height: 300px;
  margin: 10px;
  padding: 0;
  box-sizing: border-box;
  display: inline-block;
}
</style>


<div>
<textarea id="expression" />
audioParam('speed',5);
audioParam('depth',0.6);

lfo.frequency = :speed;
outlet = inlet;
outlet.gain = lfo * 0.5 * :depth + (1 - :depth )
</textarea>
<textarea id="code"></textarea>
</div>
<div id="error"></div>
<h1>WebAudio DSP Circuit Generator Generator</h1>
<div>
  <p>Generates DSP circuit for <a href="http://aklaswad.github.io/wani/">wani</a>. It includes audioParam emulator (sorry not yet documented. please see code.), so you can create your AudioNode without any scriptProcessor node ;)</p>
  <dl>
    <dt>Supported operators</dt>
    <dd><code>+</code> <code>*</code> <code>-</code></dd>
    <dt>Variables</dt>
    <dd>
      <ul>
        <li><code>name.foo</code> Existing Variable (Must be defined before this generator's code runs)
        <li><code>:name</code>  audioParam
      </ul>
    </dd>
    <dt>function</dt>
    <dd>
      audioParam(name,defaultValue)
<pre>
audioParam("depth", 0.4);

// You can reference after that
output = lfo.gain * :depth;
</pre>
      </ul>
    </dd>

  </dl>
</div>
<div>
